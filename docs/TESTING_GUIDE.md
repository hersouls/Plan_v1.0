# 🧪 Moonwave Plan Testing Guide\n\nComprehensive testing documentation for the Moonwave Plan project with Playwright E2E testing, Firebase integration, and CI/CD automation.\n\n## 📋 Table of Contents\n\n- [Overview](#overview)\n- [Quick Start](#quick-start)\n- [Test Environment Setup](#test-environment-setup)\n- [Running Tests](#running-tests)\n- [Test Structure](#test-structure)\n- [Writing Tests](#writing-tests)\n- [Firebase Testing](#firebase-testing)\n- [CI/CD Integration](#cicd-integration)\n- [Troubleshooting](#troubleshooting)\n\n## 🎯 Overview\n\nThis testing suite provides:\n\n- **End-to-End Testing** with Playwright\n- **Firebase Integration** with emulators and test data\n- **Comprehensive Test Coverage** for all features\n- **Automated Test Accounts** and authentication\n- **Sequential/Parallel Testing** modes\n- **Cross-browser Testing** (Chrome, Firefox, Safari)\n- **Mobile Testing** with responsive viewports\n- **Performance Testing** and error handling\n\n## 🚀 Quick Start\n\n### 1. Install Dependencies\n\n```bash\nnpm install\nnpx playwright install\n```\n\n### 2. Set Up Environment\n\n```bash\n# Copy test environment file\ncp .env.test .env.local\n\n# Set up Firebase test environment\nnode scripts/setupTestEnvironment.js\n```\n\n### 3. Run Tests\n\n```bash\n# Run all tests\nnpm run test:e2e\n\n# Run tests with UI\nnpm run test:e2e:ui\n\n# Run tests in headed mode\nnpm run test:e2e:headed\n\n# Run specific test file\nnpx playwright test tests/e2e/01-app-startup.spec.ts\n```\n\n## ⚙️ Test Environment Setup\n\n### Environment Variables\n\nThe test environment uses `.env.test` for configuration:\n\n```bash\n# Test Environment\nNODE_ENV=test\nTEST_SEQUENTIAL=true\nTEST_BASE_URL=http://localhost:3002\n\n# Firebase Test Configuration\nVITE_USE_FIREBASE_EMULATOR=true\nVITE_FIREBASE_AUTH_EMULATOR_URL=http://localhost:9099\nVITE_FIREBASE_FIRESTORE_EMULATOR_HOST=localhost:8080\n\n# Test User Accounts\nTEST_USER_EMAIL=dad@moonwave.test\nTEST_USER_PASSWORD=test123456\n```\n\n### Test Accounts\n\nPre-configured test accounts:\n\n| Role | Email | Password | Name |\n|------|-------|----------|------|\n| Parent | `dad@moonwave.test` | `test123456` | 김아빠 |\n| Parent | `mom@moonwave.test` | `test123456` | 박엄마 |\n| Child | `suhyun@moonwave.test` | `test123456` | 김수현 |\n| Child | `dohyun@moonwave.test` | `test123456` | 김도현 |\n\n**Family Group:** `family-kim-2024` (Invite Code: `MOON2024`)\n\n### Firebase Emulators\n\nThe test environment automatically starts Firebase emulators:\n\n- **Firestore:** http://localhost:8080\n- **Authentication:** http://localhost:9099\n- **Storage:** http://localhost:9199\n- **Emulator UI:** http://localhost:4000\n\n## 🏃‍♂️ Running Tests\n\n### Test Execution Modes\n\n```bash\n# Sequential testing (recommended for Firebase)\nnpm run test:e2e\n\n# Parallel testing (faster, but may have Firebase conflicts)\nTEST_SEQUENTIAL=false npm run test:e2e\n\n# Debug mode with browser visible\nnpm run test:e2e:headed\n\n# Interactive mode with Playwright UI\nnpm run test:e2e:ui\n\n# Generate test report\nnpm run test:e2e:report\n```\n\n### Filtering Tests\n\n```bash\n# Run specific test suite\nnpx playwright test --grep \"Dashboard Features\"\n\n# Run tests for specific component\nnpx playwright test --grep \"Task Management\"\n\n# Run tests with specific tag\nnpx playwright test --grep \"@smoke\"\n\n# Skip specific tests\nnpx playwright test --grep-invert \"@slow\"\n```\n\n### Browser Testing\n\n```bash\n# Run on specific browser\nnpx playwright test --project=chromium\nnpx playwright test --project=firefox\nnpx playwright test --project=webkit\n\n# Run on mobile devices\nnpx playwright test --project=\"Mobile Chrome\"\nnpx playwright test --project=\"Mobile Safari\"\n```\n\n## 📁 Test Structure\n\n```\ntests/\n├── e2e/                           # End-to-end test suites\n│   ├── 01-app-startup.spec.ts     # App initialization & PWA\n│   ├── 02-task-management.spec.ts # Task CRUD operations\n│   ├── 03-pwa-features.spec.ts    # PWA functionality\n│   ├── 04-family-collaboration.spec.ts # Family features\n│   ├── 05-dashboard-features.spec.ts   # Dashboard testing\n│   └── 06-task-management.spec.ts      # Comprehensive task tests\n├── fixtures/                      # Test fixtures and data\n│   └── firebase-mock.ts           # Firebase mocking utilities\n├── utils/                         # Test utilities\n│   ├── mcp-helpers.ts             # MCP testing helpers\n│   └── page-objects.ts            # Page object models\n├── global-setup.ts                # Global test setup\n├── global-teardown.ts             # Global test cleanup\n└── auth-states.json               # Authentication states\n```\n\n### Test Categories\n\n1. **Smoke Tests** (`@smoke`) - Critical functionality\n2. **Regression Tests** (`@regression`) - Bug prevention\n3. **Integration Tests** (`@integration`) - Component interaction\n4. **Performance Tests** (`@performance`) - Speed and responsiveness\n5. **Mobile Tests** (`@mobile`) - Mobile-specific features\n\n## ✏️ Writing Tests\n\n### Basic Test Structure\n\n```typescript\nimport { test, expect } from '../fixtures/firebase-mock'\nimport { LoginPage, DashboardPage } from '../utils/page-objects'\n\ntest.describe('Feature Name', () => {\n  let loginPage: LoginPage\n  let dashboardPage: DashboardPage\n\n  test.beforeEach(async ({ page }) => {\n    loginPage = new LoginPage(page)\n    dashboardPage = new DashboardPage(page)\n    \n    // Authenticate user\n    await loginPage.navigateTo()\n    await loginPage.loginWithCredentials('dad@moonwave.test', 'test123456')\n  })\n\n  test('should perform basic functionality', async ({ page }) => {\n    await dashboardPage.navigateTo()\n    \n    // Test implementation\n    await expect(dashboardPage.todaysTasksSection).toBeVisible()\n  })\n})\n```\n\n### Using Page Objects\n\n```typescript\n// Navigate to pages\nawait loginPage.navigateTo()\nawait dashboardPage.navigateTo()\nawait taskPage.navigateToCreate()\n\n// Perform actions\nawait loginPage.loginWithCredentials(email, password)\nawait taskPage.fillTaskTitle('New Task')\nawait taskPage.selectCategory('work')\nawait taskPage.saveTask()\n\n// Verify results\nconst taskCount = await dashboardPage.getTotalTasksCount()\nexpect(taskCount).toBeGreaterThan(0)\n```\n\n### Test Data and Fixtures\n\n```typescript\n// Use predefined test data\nconst testTask = {\n  title: `Test Task ${Date.now()}`,\n  description: 'Automated test task',\n  category: 'personal',\n  priority: 'medium'\n}\n\n// Create test data\nawait taskPage.addDetailedTask(testTask)\n\n// Clean up after test\ntest.afterEach(async ({ page }) => {\n  await taskPage.deleteTask(testTask.title)\n})\n```\n\n### Error Handling\n\n```typescript\ntest('should handle errors gracefully', async ({ page }) => {\n  // Test error scenarios\n  await page.route('**/api/tasks', route => route.abort())\n  \n  // Verify error handling\n  await expect(page.locator('.error-message')).toBeVisible()\n  \n  // Clean up\n  await page.unroute('**/api/tasks')\n})\n```\n\n## 🔥 Firebase Testing\n\n### Emulator Setup\n\nFirebase emulators are automatically managed:\n\n```javascript\n// Global setup starts emulators\nawait startFirebaseEmulators()\n\n// Tests use emulated services\nconst db = getFirestore()\nconst auth = getAuth()\n```\n\n### Test Data Management\n\n```typescript\n// Reset data before tests\ntest.beforeEach(async () => {\n  await clearFirebaseData()\n  await setupTestData()\n})\n\n// Use test accounts\nconst testUser = {\n  email: 'dad@moonwave.test',\n  password: 'test123456'\n}\n```\n\n### Security Rules Testing\n\n```typescript\ntest('should enforce security rules', async ({ page }) => {\n  // Test with different user permissions\n  await loginPage.loginWithCredentials('child@moonwave.test', 'test123456')\n  \n  // Verify restricted actions fail\n  await expect(page.locator('.admin-only')).not.toBeVisible()\n})\n```\n\n## 🔄 CI/CD Integration\n\n### GitHub Actions\n\nCreate `.github/workflows/playwright.yml`:\n\n```yaml\nname: Playwright Tests\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    timeout-minutes: 60\n    runs-on: ubuntu-latest\n    \n    steps:\n    - uses: actions/checkout@v3\n    \n    - uses: actions/setup-node@v3\n      with:\n        node-version: 18\n        \n    - name: Install dependencies\n      run: npm ci\n      \n    - name: Install Playwright Browsers\n      run: npx playwright install --with-deps\n      \n    - name: Run Playwright tests\n      run: npm run test:e2e\n      env:\n        CI: true\n        TEST_SEQUENTIAL: true\n        \n    - uses: actions/upload-artifact@v3\n      if: always()\n      with:\n        name: playwright-report\n        path: playwright-report/\n        retention-days: 30\n```\n\n### Environment Variables for CI\n\n```bash\n# Set in GitHub Actions secrets\nVITE_FIREBASE_API_KEY=your-test-api-key\nVITE_FIREBASE_PROJECT_ID=your-test-project\nTEST_USER_EMAIL=test@example.com\nTEST_USER_PASSWORD=secure-password\n```\n\n## 🐛 Troubleshooting\n\n### Common Issues\n\n#### 1. Firebase Connection Errors\n\n```bash\n# Check emulator status\ncurl http://localhost:8080\ncurl http://localhost:9099\n\n# Restart emulators\nnpx firebase emulators:kill\nnode scripts/setupTestEnvironment.js\n```\n\n#### 2. Test Timeouts\n\n```typescript\n// Increase timeouts for slow operations\ntest('slow operation', async ({ page }) => {\n  test.setTimeout(120000) // 2 minutes\n  \n  await expect(element).toBeVisible({ timeout: 30000 })\n})\n```\n\n#### 3. Authentication Issues\n\n```bash\n# Clear auth state\nrm tests/auth-state.json\n\n# Recreate test accounts\nnode scripts/setupTestEnvironment.js\n```\n\n#### 4. Port Conflicts\n\n```bash\n# Check for port usage\nnetstat -tulpn | grep :3002\nnetstat -tulpn | grep :8080\n\n# Kill conflicting processes\nkill -9 $(lsof -t -i:3002)\n```\n\n### Debug Mode\n\n```bash\n# Run with debug output\nDEBUG=pw:api npm run test:e2e\n\n# Generate trace files\nnpx playwright test --trace on\n\n# View traces\nnpx playwright show-trace trace.zip\n```\n\n### Test Reports\n\n```bash\n# Generate HTML report\nnpm run test:e2e:report\n\n# View test results\nopen playwright-report/index.html\n```\n\n## 📊 Test Metrics\n\n### Coverage Goals\n\n- **Core Features:** 90%+ coverage\n- **User Workflows:** 100% critical paths\n- **Error Scenarios:** 80%+ edge cases\n- **Cross-browser:** Chrome, Firefox, Safari\n- **Mobile:** iOS Safari, Chrome Mobile\n\n### Performance Benchmarks\n\n- **Page Load:** < 3 seconds\n- **Task Creation:** < 2 seconds\n- **Authentication:** < 5 seconds\n- **Search Results:** < 1 second\n\n## 🎯 Best Practices\n\n1. **Use Page Objects** for reusable interactions\n2. **Mock External Services** to avoid dependencies\n3. **Clean Up Test Data** after each test\n4. **Test Error Scenarios** not just happy paths\n5. **Use Sequential Mode** for Firebase tests\n6. **Add Retry Logic** for flaky tests\n7. **Screenshot on Failure** for debugging\n8. **Test Mobile Responsiveness** on actual devices\n\n## 📚 Additional Resources\n\n- [Playwright Documentation](https://playwright.dev)\n- [Firebase Emulator Suite](https://firebase.google.com/docs/emulator-suite)\n- [Testing Best Practices](https://playwright.dev/docs/best-practices)\n- [CI/CD Integration Guide](https://playwright.dev/docs/ci)\n\n---\n\n🎉 **Happy Testing!** This comprehensive setup ensures reliable, maintainable tests for the Moonwave Plan application."